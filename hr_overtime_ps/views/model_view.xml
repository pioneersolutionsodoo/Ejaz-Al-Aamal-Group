<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--        Overtime Form View      -->
        <record id="view_hr_overtime_ps_form" model="ir.ui.view">
            <field name="name">hr.overtime.ps.form</field>
            <field name="model">hr.overtime.ps</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="OverTime Request" version="7.0">
                    <header>
                        <button string="Send Request" name="action_request" type="object" states="draft"/>
                        <button string="Confirm" name="action_confirm" type="object" class="oe_highlight" icon="gtk-yes"
                                attrs="{'invisible':['|',('current_user', '=', False),('state','!=','request')]}"/>
                        <button string="Approve" name="action_approve" type="object" states="confirm"
                                groups="hr.group_hr_manager"/>
                        <button string="Refuse" name="action_refuse" type="object" states="request,confirm"/>
                        <field name="state" string="Status" readonly="True"
                               widget="statusbar" statusbar_visible="draft,"
                               statusbar_colors='{"confirm":"blue","draft":"red"}'/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" string="Name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="employee_id" required="1" string="Employee"
                                       domain="[('user_id','in',[context.get('uid')])]"
                                       attrs="{'readonly': [('state','in',['approve','refuse'])]}"
                                       on_change="onchange_employee_id(employee_id)"/>
                                <field name="department_id" string="Department"/>
                                <field name="date_from" required="1" string="Date From"
                                       on_change="on_change_date_from_to(date_from,date_to)"/>
                                <field name="request_hours" string="Request Hours"/>
                                <field name="worked_days" required="1" string="Worked Days"
                                       groups="hr.group_hr_manager"/>
                                <field name="worked_hours" required="1" string="Worked Hours"
                                       groups="hr.group_hr_manager"/>
                                <field name="ot_per_hour" string="Overtime Per Hour"
                                       attrs="{'readonly': [('state','in',['approve','refuse'])]}"/>
                                <field name="current_user" string="Current User"
                                       invisible='1'/>
                            </group>
                            <group>
                                <field name="contract_id" required="1" string="Contract"
                                       domain="[('employee_id', '=', employee_id)]"
                                       attrs="{'readonly': [('state','in',['approve','refuse'])]}"/>
                                <field name="job_id" string="Job"/>
                                <field name="date_to" required="1" string="Date To"
                                       on_change="on_change_date_from_to(date_from,date_to)"/>
                                <field name="approved_hours" string="Approved Hours"/>
                                <field name="company_id" string="Company" required="1"
                                       attrs="{'readonly': [('state','in',['approve','refuse'])]}"
                                       groups="base.group_multi_company" readonly="1"/>
                            </group>

                        </group>
                        <notebook>
                            <page string="Work Summary">
                                <field name="overtime_summary" colspan="4" string="Work Summary" nolabel="1"
                                       attrs="{'readonly': [('state','in',['approve','refuse'])]}">
                                    <tree string="Work Summary" editable="bottom">
                                        <field name="name" string="Name"/>
                                        <field name="date" string="Date"/>
                                        <field name="request_hours" string="Request Hours"/>
                                        <field name="approved_hours" string="Approved Hours"
                                               groups="hr.group_hr_user"/>
                                    </tree>
                                </field>
                                <field name="note" string="Note"/>
                            </page>
                            <page string="Approval Notes">
                                <group>
                                    <field name="d_manager" readonly="1"/>
                                    <field name="d_manager_note" nolabel="1"
                                           placeholder="Direct Manager Note"
                                           attrs="{'readonly':[('state','!=','request')]}"/>
                                    <field name="hr_manager_id" readonly="1"/>
                                    <field name="hr_manager_note" nolabel="1" placeholder='HR Manager Note'
                                           attrs="{'readonly':[('state','!=','confirm')]}"/>
                                    <field name="refused_by" readonly="1"
                                           attrs="{'invisible':[('state','!=','refuse')]}"/>
                                </group>
                            </page>
                        </notebook>
                        <group class="oe_subtotal_footer oe_right" colspan="2">
                            <field name="total" widget="monetary" readonly="1" attrs="{'invisible': [('state','!=','approve')]}"
                                   options="{'currency_field': 'currency_id'}"/>
                        </group>

                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>

            </field>
        </record>

        <record id="view_hr_overtime_ps_tree" model="ir.ui.view">
            <field name="name">hr.overtime.ps.tree</field>
            <field name="model">hr.overtime.ps</field>
            <!--            <field name="type">tree</field>-->
            <field name="arch" type="xml">
                <tree string="Leave Request">
                    <!--                      colors="black:state=='draft';blue:state=='request';green:state=='confirm';red:state=='refuse'">-->
                    <field name="name" string="Name"/>
                    <field name="employee_id" string="Employee"/>
                    <field name="date_from" string="Date From"/>
                    <field name="date_to" string="Date To"/>
                    <field name="request_hours" string="Request Hours"/>
                    <field name="approved_hours" string="Approved Hours"/>
                    <field name="state" string="Status"/>
                </tree>
            </field>
        </record>

        <record id="view_hr_overtime_ps_filter" model="ir.ui.view">
            <field name="name">hr.overtime.ps.filter</field>
            <field name="model">hr.overtime.ps</field>
            <field name="arch" type="xml">
                <search string="Search OverTime">
                    <field name="name" string="Name"/>
                    <separator/>
                    <filter icon="terp-check" domain="[('state','=','draft')]" string="To Request" name="draft"/>
                    <filter icon="terp-camera_test" domain="[('state','=','request')]" string="To Confirm"
                            name="request"/>
                    <filter icon="terp-camera_test" domain="[('state','=','confirm')]" string="To Approve"
                            name="confirm"/>
                    <filter icon="terp-camera_test" domain="[('state','in',('approve','refuse'))]" string="Validated"
                            name="validate"/>

                    <separator/>
                    <filter string="My OverTime" icon="terp-personal" name="my_overtime"
                            domain="[('employee_id.user_id','=', uid)]" help="My OverTime"/>
                    <separator/>

                    <group expand="0" string="Group By...">
                        <filter name="group_name" string="Description" domain="[]" context="{'group_by':'name'}"/>
                        <filter name="group_date_from" string="Date From" domain="[]"
                                context="{'group_by':'date_from'}"/>
                        <filter name="group_date_to" string="Date To" domain="[]" context="{'group_by':'date_to'}"/>
                        <filter name="group_employee" string="Employee" domain="[]"
                                context="{'group_by':'employee_id'}"/>
                        <filter name="group_status" string="Status" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_hr_overtime_ps_calendar" model="ir.ui.view">
            <field name="name">hr.overtime.ps.calendar</field>
            <field name="model">hr.overtime.ps</field>
            <field name="arch" type="xml">
                <calendar string="Leave Request" color="employee_id" date_start="date_from" date_stop="date_to">
                    <field name="name" string="Name"/>
                    <field name="employee_id" string="Employee"/>
                    <field name="state" string="Status" invisible="1"/>
                </calendar>
            </field>
        </record>

        <!-- Action-->
        <record id="action_hr_overtime_ps_my" model="ir.actions.act_window">
            <field name="name">My OverTime</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.overtime.ps</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="domain">[('employee_id.user_id', 'in', [uid])]</field>
            <field name="context">{'user': 'user_id','cond': 'in','val': uid}</field>
            <field name="view_id" ref="view_hr_overtime_ps_tree"/>
        </record>

        <record id="action_hr_overtime_ps_direct" model="ir.actions.act_window">
            <field name="name">D-Mgr Approval</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.overtime.ps</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="domain">[('employee_id.parent_id.user_id', 'in', [uid])]</field>
            <field name="context">{'user': 'parent_id.user_id','cond': 'in','val': uid,'search_default_request':1}
            </field>
            <field name="view_id" ref="view_hr_overtime_ps_tree"/>
            <field name="search_view_id" ref="view_hr_overtime_ps_filter"/>
        </record>

        <record id="action_hr_overtime_ps_hr" model="ir.actions.act_window">
            <field name="name">HR-Mgr Approval</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.overtime.ps</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="context">{'user': 'id','cond': 'not in','val': False,'search_default_confirm':1}</field>
            <field name="view_id" ref="view_hr_overtime_ps_tree"/>
            <field name="search_view_id" ref="view_hr_overtime_ps_filter"/>
        </record>

        <!-- Menu-->
        <!--
                <menuitem id="hr_overtime_main_menu" name="OverTime" sequence="29" parent ="hr.menu_hr_root"/>
        -->
        <menuitem id="hr_overtime_ps_menu_my" name="My OverTime" action="action_hr_overtime_ps_my"
                  parent="hr_overtime_main_menu" sequence="1"/>

        <menuitem id="hr_overtime_ps_menu_direct" name="D-Mgr Approval" action="action_hr_overtime_ps_direct"
                  parent="hr_overtime_main_menu" sequence="2"/>

        <menuitem id="hr_overtime_ps_menu_hr" name="HR-Mgr Approval" action="action_hr_overtime_ps_hr"
                  parent="hr_overtime_main_menu" sequence="3" groups="hr.group_hr_manager"/>

    </data>
</odoo>
